<div class="row g-3">
    <div class="col-12 col-xl-8">
        <form class="row g-3" [formGroup]="productForm">
            <span class="col-12 h4 pt-3">
                Thông tin cơ bản (màu đỏ là trường bắt buộc)
            </span>
            <div class="col-12">
                <div class="row border border-dark mx-auto">
                    <div class="col-12">
                        <div class="row align-items-center py-1">
                            <div class="col-xl-3">
                                <label for="pdtCode" class="col-form-label text-red">Mã sản phẩm</label>
                            </div>
                            <div class="col-xl-4">
                                <input type="text" id="pdtCode" class="form-control" formControlName="pdtCode"
                                [ngClass]="{'is-invalid': submitted && f['pdtCode'].errors }" aria-describedby="pdtCodeHelpBlock">
                            </div>

                            <div class="col-auto">
                                <div id="pdtCodeHelpBlock" class="form-text text-red">
                                    Nếu không nhập, mã sẽ tự động được tạo
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-12">
                        <div class="row align-items-center py-1">
                            <div class="col-xl-3">
                                <label for="pdtName" class="col-form-label text-red">Tên sản phẩm</label>
                            </div>
                            <div class="col-xl-9">
                                <input type="text" id="pdtName" class="form-control" formControlName="pdtName"
                                [ngClass]="{'is-invalid': submitted && f['pdtName'].errors }">
                            </div>
                        </div>
                    </div>
                    <div class="col-12">
                        <div class="row align-items-center py-1">
                            <div class="col-xl-3">
                                <label for="pdtNameEng" class="col-form-label">Tên sản phẩm (tiếng anh)</label>
                            </div>
                            <div class="col-xl-9">
                                <input type="text" id="pdtNameEng" class="form-control" formControlName="pdtNameEng"
                                [ngClass]="{'is-invalid': submitted && f['pdtNameEng'].errors }">
                            </div>
                        </div>
                    </div>

                    <div class="col-12">
                        <div class="row align-items-center py-1">
                            <div class="col-xl-3">
                                <label for="categoryId" class="col-form-label text-red">Tên danh mục</label>
                            </div>
                            <div class="col-auto">
                                <select id="categoryId" class="form-select" #select (change)="onChangeCategoryId(select.value)"
                                    [ngClass]="{'is-invalid': submitted && f['categoryId'].errors }">
                                    <option value="0" [selected]="categoryIdSelected === 0">Chọn danh mục</option>
                                    @if (categories.length > 0) {
                                        @for (item of categories; track item.id) {
                                            <option [value]="item.id" [selected]="categoryIdSelected === item.id">{{ item | transformCategory }}
                                            </option>
                                        }
                                    }
                        </select>
                            </div>
                        </div>
                    </div>
                    <div class="col-12">
                        <div class="row align-items-center py-1">
                            <div class="col-xl-3">
                                <label for="option1" class="col-form-label">Thời gian</label>
                            </div>
                            <div class="col-xl-9">
                                <input type="text" id="option1" class="form-control" formControlName="option1"
                                [ngClass]="{'is-invalid': submitted && f['option1'].errors }">
                            </div>
                        </div>
                    </div>

                    <div class="col-12">
                        <div class="row align-items-center py-1">
                            <div class="col-xl-3">
                                <label for="option2" class="col-form-label">Lịch trình</label>
                            </div>
                            <div class="col-xl-9">
                                <input type="text" id="option2" class="form-control" formControlName="option2"
                                [ngClass]="{'is-invalid': submitted && f['option2'].errors }">
                            </div>
                        </div>
                    </div>

                    <div class="col-12">
                        <div class="row align-items-center py-1">
                            <div class="col-xl-3">
                                <label for="option3" class="col-form-label">Phương tiện</label>
                            </div>
                            <div class="col-xl-9">
                                <input type="text" id="option3" class="form-control" formControlName="option3"
                                [ngClass]="{'is-invalid': submitted && f['option3'].errors }">
                            </div>
                        </div>
                    </div>
                    <div class="col-12">
                        <div class="row align-items-center py-1">
                            <div class="col-xl-3">
                                <label for="option3" class="col-form-label">Sắp xếp</label>
                            </div>
                            <div class="col-auto">
                                <input type="number" id="sort" value="0" class="form-control" formControlName="sort" min="0">
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <span class="col-12 h4 pt-3">
                Thông tin đặt hàng
            </span>

            <div class="col-12">
                <div class="row border border-dark mx-auto">
                    <div class="col-12">
                        <div class="row align-items-center py-1">
                            <div class="col-12">
                                <div class="row align-items-center py-1">
                                    <div class="col-xl-3">
                                        <label for="status" class="col-form-label text-red">Trạng thái</label>
                                    </div>
                                    <div class="col-auto">
                                        <select id="status" class="form-select" #select2 (change)="onChangeStatus(select2.value)"
                                        [ngClass]="{'is-invalid': submitted && f['status'].errors }">
                                        <option value="0" [selected]="statusSelected === '0'">Chọn trạng thái</option>
                                        @if (code.length > 0) {
                                        @for (item of code; track item.id) {
                                        <option [value]="item.codeCd" [selected]="statusSelected === item.codeCd">{{ item.codeName }}
                                        </option>
                                        }
                                        }
                                    </select>
                                    </div>
                                </div>
                            </div>
                            <div class="col-12">
                                <div class="row align-items-center py-1">
                                    <div class="col-xl-3">
                                        <label for="status" class="col-form-label text-red">thời hạn bán</label>
                                    </div>
                                    <div class="col-xl-9">
                                        <div class="d-flex justify-content-between align-items-center gap-2">
                                            <p-calendar formControlName="saleStartDate" dataType="string" variant="filled" [showIcon]="true" readonlyInput="true" dateFormat="yy/mm/dd" [ngClass]="{'ng-invalid ng-dirty': submitted && f['saleStartDate'].errors }"/>
                                            <span>~</span>
                                            <p-calendar formControlName="saleEndDate" dataType="string" variant="filled" [showIcon]="true" readonlyInput="true" dateFormat="yy/mm/dd" [ngClass]="{'ng-invalid ng-dirty': submitted && f['saleEndDate'].errors }"/>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="col-12">
                                <div class="row align-items-center py-1">
                                    <div class="col-xl-3">
                                        <label for="supplyAmt" class="col-form-label">Giá cung cấp</label>
                                    </div>
                                    <div class="col-auto">
                                        <input type="number" id="supplyAmt" class="form-control" formControlName="supplyAmt"
                                        [ngClass]="{'is-invalid': submitted && f['supplyAmt'].errors }">
                                    </div>
                                    <div class="col-auto">
                                        <span>VNĐ</span>
                                    </div>
                                </div>
                            </div>
                            <div class="col-12">
                                <div class="row align-items-center py-1">
                                    <div class="col-xl-3">
                                        <label for="retailAmt" class="col-form-label">Giá khách hàng</label>
                                    </div>
                                    <div class="col-auto">
                                        <input type="number" id="retailAmt" class="form-control" formControlName="retailAmt"
                                        [ngClass]="{'is-invalid': submitted && f['retailAmt'].errors }">
                                    </div>
                                    <div class="col-auto">
                                        <span>VNĐ</span>
                                    </div>
                                </div>
                            </div>
                            <div class="col-12">
                                <div class="row align-items-center py-1">
                                    <div class="col-xl-3">
                                        <label for="tax" class="col-form-label">Thuế</label>
                                    </div>
                                    <div class="col-auto">
                                        <input type="number" id="tax" class="form-control" formControlName="tax"
                                        [ngClass]="{'is-invalid': submitted && f['tax'].errors }">
                                    </div>
                                    <div class="col-auto">
                                        <span>%</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <span class="col-12 h4 pt-3">
                Thông tin khuyến mãi và sự kiện
            </span>

            <div class="col-12">
                <div class="row border border-dark mx-auto">
                    <div class="col-12">
                        <div class="row align-items-center py-1">
                            <div class="col-12">
                                <div class="row align-items-center py-1">
                                    <div class="col-xl-3">
                                        <label for="status" class="col-form-label">Sản phẩm mới</label>
                                    </div>
                                    <div class="col-xl-9">
                                        <div class="d-flex justify-content-between align-items-center gap-2">
                                            <p-calendar formControlName="newStartDate" dataType="string" variant="filled" [showIcon]="true" readonlyInput="true" dateFormat="yy/mm/dd"/>
                                            <span>~</span>
                                            <p-calendar formControlName="newEndDate" dataType="string" variant="filled" [showIcon]="true" readonlyInput="true" dateFormat="yy/mm/dd"/>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="col-12">
                                <div class="row align-items-center py-1">
                                    <div class="col-xl-3">
                                        <label for="status" class="col-form-label">Sản phẩm tốt nhất</label>
                                    </div>
                                    <div class="col-xl-9">
                                        <div class="d-flex justify-content-between align-items-center gap-2">
                                            <p-calendar formControlName="bestStartDate" dataType="string" variant="filled" [showIcon]="true" readonlyInput="true" dateFormat="yy/mm/dd"/>
                                            <span>~</span>
                                            <p-calendar formControlName="bestEndDate" dataType="string" variant="filled" [showIcon]="true" readonlyInput="true" dateFormat="yy/mm/dd"/>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="col-12">
                                <div class="row align-items-center py-1">
                                    <div class="col-xl-3">
                                        <label for="status" class="col-form-label">Sản phẩm khuyến mãi</label>
                                    </div>
                                    <div class="col-xl-9">
                                        <div class="d-flex justify-content-between align-items-center gap-2">
                                            <p-calendar formControlName="promotionStartDate" dataType="string" variant="filled" [showIcon]="true" readonlyInput="true" dateFormat="yy/mm/dd"/>
                                            <span>~</span>
                                            <p-calendar formControlName="promotionEndDate" dataType="string" variant="filled" [showIcon]="true" readonlyInput="true" dateFormat="yy/mm/dd"/>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- @if (f['id'].value > 0) {
                                <div class="col-auto d-flex justify-content-center align-items-center">
                                    <input class="form-check-input" type="checkbox" formControlName="used">
                                    <label class="form-check-label ms-3 text-dark">Sử dụng</label>
                                </div>
                            } -->
                        </div>
                    </div>
                </div>
            </div>

            <div class="col-12 d-flex justify-content-center gap-3 py-3">
                <button class="btn btn-primary" (click)="onSubmit()">Lưu thông tin</button>
                <button class="btn btn-gray border border-secondary" (click)="onReset()">Reset</button>
            </div>
        </form>
    </div>
    <div class="col-12 col-xl-4">
        <div class="row border position-xl-fixed">
            <span class="col-12 h3 d-flex justify-content-center align-items-center p-3">
                Danh sách sản phẩm
            </span>
            <div class="col-12">
                <div class="table overflow-auto" style="height: 500px;" (scroll)="onScroll($event)">
                    <table class="table table-bordered">
                        <thead>
                            <tr>
                                <th class="text-center text-nowrap py-2">Mã sản phẩm</th>
                                <th class="text-center text-nowrap py-2">Tên</th>
                            </tr>
                        </thead>
                        <tbody>
                            @for (item of products; track item.id) {
                            <tr role="button" (click)="onClickRow(item)">
                                <td class="text-center text-nowrap py-2" [ngClass]="{'bg-primary text-white': productCode === item.pdtCode}">{{ item.pdtCode }}</td>
                                <td class="text-center text-nowrap py-2" [ngClass]="{'bg-primary text-white': productCode === item.pdtCode}">{{ item.pdtName }}</td>
                            </tr>
                            }
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>

<p-toast position="bottom-right" key="br" />
